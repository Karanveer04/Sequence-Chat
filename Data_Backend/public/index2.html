<!DOCTYPE html>
<html>
<head>
    <title>SocketCluster</title>
    <link href="//fonts.googleapis.com/css?family=Roboto:100,300" rel="stylesheet" type="text/css">
    <link rel="icon" type="image/png" href="/favicon.ico">

    <link rel="stylesheet" href="style.css" type="text/css">
    <script type="text/javascript" src="/socketcluster.js"></script>

</head>
<body>

<header>
    <h1 id="center">Sequence Cat</h1>
</header>

<div id="dump">
    <div id="drop_zone">
        <h2> Drop Your JSon File here</h2>
    </div>

    <input id="btn" type="file" style="display:none;" onchange="document.getElementById('file').value=this.value.substring(this.value.lastIndexOf('\\')+1);">
    <button id="browse" class="button" onclick="document.getElementById('btn').click()">Browse</button>

</div>

<div class="l-wrap" id="wrap">
</div>

<script type="text/javascript">
    // Initiate the connection to the server
    console.log("he");
    var socket = socketCluster.connect();
    socket.on('error', function (err) {
        throw 'Socket error - ' + err;
    });
    socket.on('connect', function () {
        console.log('CONNECTED');
    });
    var channels = [];
    socket.on('word', function (data) {
        var fro = data.from;
        if (fro !== 'g') {
            var currentdate = new Date();
            var datetime = currentdate.getMinutes() + ":"
                + currentdate.getSeconds();

            var user = data.message[1];
            var div = document.getElementById('wrap');
            var other = document.getElementById(user+fro);
            var self = document.getElementById(fro+user);
            var message = data.message[2];
            if (channels.includes(user+fro)){
                self.innerHTML +=
                    '<li class="self">' +
                    '<div class="messages">' +
                    '<p id="message">' + message + '</p>' +
                    '<time>' +
                    fro + datetime +
                    '</time>' +
                    '</div>' +
                    '</li>';

            }
            else if(channels.includes(fro+user)){
                other.innerHTML +=
                    '<li class="other">' +
                    '<div class="messages">' +
                    '<p id="message">' + message + '</p>' +
                    '<time>' +
                    fro + datetime +
                    '</time>' +
                    '</div>' +
                    '</li>';

            }
            else{
                div.innerHTML +=
                    '<div class="three-col-grid">' +
                    '<div class="grid-item">' +
                    '<section class="module">' +
                    '<div class="top-bar">' +
                    '<div class="left">' +
                    '<span class="icon typicons-message"></span>' +
                    '<h1 id="user">' + user + " and " + fro + '</h1>' +
                    '</div>' +
                    '</div>' +
                    '<ol class="discussion" id="'+user+fro+'">' +
                    '<li class="other">' +
                    '<div class="messages">' +
                    '<p id="message">' + message + '</p>' +
                    '<time id="time">' + fro + ' â€¢' + datetime + '</time>' +
                    '</div>' +
                    '</li>' +
                    '</ol>' +
                    '</section>' +
                    '</div>' +
                    '</div>';
                channels.push(user+fro);
                channels.push(fro+user);
            }
            //document.getElementById('user').innerHTML = data.from;
            //document.getElementById('message').innerHTML +=  data.message[2];
            console.log('RANDOM STREAM: ' + data.from + data.to + data.message);
        }
    });

</script>

</body>
</html>