<!DOCTYPE html>
<html>
<head>
  <title>SocketCluster</title>
  <link href="//fonts.googleapis.com/css?family=Roboto:100,300" rel="stylesheet" type="text/css">
  <link rel="icon" type="image/png" href="/favicon.ico">
  <link rel="stylesheet" href="style.css" type="text/css">
  <script type="text/javascript" src="/socketcluster.js"></script>
</head>
<body>
<header>
  <h1 id="center">Sequence C(h)at</h1>
</header>
<div id="dump">
  <div id="drop_zone">
    <h2> Drop Your JSon File here</h2>
  </div>
  <input id="btn" type="file" style="display:none;" onchange="document.getElementById('file').value=this.value.substring(this.value.lastIndexOf('\\')+1);">
 <input type='file' id="upload" onchange="readUrl(this.value); this.style.visibility='hidden'" />



</div>

<div class="l-wrap" id="wrap">
</div>

<div id='execution_log'>
    execution log



</div>

<script type="text/javascript">
    // Initiate the connection to the server
    console.log("he");
    var socket = socketCluster.connect();
    socket.on('error', function (err) {
        throw 'Socket error - ' + err;
    });
    socket.on('connect', function () {
        console.log('CONNECTED');
    });

    var channels = [];
     var sampleChannel = socket.subscribe('sample');

      sampleChannel.on('subscribeFail', function (err) {
        console.log('Failed to subscribe to the sample channel due to error: ' + err);
      });

     function readUrl(input){
      jsonInput = input.replace("C:\\fakepath\\", "")
      socket.emit('go', jsonInput);
    }


    sampleChannel.watch(function (data) {

        var fro = data.from;
        var user = data.to;
        if (user !== undefined) {
            var currentdate = new Date();
            var datetime = currentdate.getMinutes() + ":"
                + currentdate.getSeconds();
            var div = document.getElementById('wrap');
            var self = document.getElementById(fro+user);
            var other = document.getElementById(user+fro);
            var message = data.message;



            if (channels.includes(user+fro)){

                other.innerHTML +=
                    '<li class="other">' +
                    '<div class="messages">' +
                    '<p id="message">' + message + '</p>' +
                    '<time>' +
                    fro + ' • ' + datetime +
                    '</time>' +
                    '</div>' +
                    '</li>';
            }
            else if(channels.includes(fro+user)){
                self.innerHTML +=
                    '<li class="self">' +
                    '<div class="messages">' +
                    '<p id="message">' + message + '</p>' +
                    '<time>' +
                    fro + ' • ' + datetime +
                    '</time>' +
                    '</div>' +
                    '</li>';
            }
            else{
               div.innerHTML +=
                    '<div class="three-col-grid">' +
                    '<div class="grid-item">' +
                    '<section class="module">' +
                    '<div class="top-bar">' +
                    '<div class="left">' +
                    '<span class="icon typicons-message"></span>' +
                    '<h1 id="user">' + fro + " and " + user + '</h1>' +
                    '</div>' +
                    '</div>' +
                    '<ol class="discussion" id="'+user+fro+'">' +
                    '<li class="other">' +
                    '<div class="messages">' +
                    '<p id="message">' + message + '</p>' +
                    '<time id="time">' + fro + ' • ' + datetime + '</time>' +
                    '</div>' +
                    '</li>' +
                    '</ol>' +
                    '</section>' +
                    '</div>' +
                    '</div>';
                channels.push(user+fro);
            }
            //document.getElementById('user').innerHTML = data.from;
            //document.getElementById('message').innerHTML +=  data.message[2];
            console.log('RANDOM STREAM: ' + data.from + data.to + data.message);
        }
    });
</script>
</body>
</html>
